"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[331],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>k});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=a.createContext({}),p=function(e){var t=a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(r),d=n,k=c["".concat(s,".").concat(d)]||c[d]||m[d]||o;return r?a.createElement(k,l(l({ref:t},u),{},{components:r})):a.createElement(k,l({ref:t},u))}));function k(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:n,l[1]=i;for(var p=2;p<o;p++)l[p]=r[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},6647:(e,t,r)=>{r.r(t),r.d(t,{contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>s});var a=r(7462),n=(r(7294),r(3905));const o={},l="Rank Store",i={type:"mdx",permalink:"/RankStore/",source:"@site/pages/index.md",title:"Rank Store",description:"RankStore is a reliable and scalable system for managing persistent leaderboards using ROBLOX DataStores. RankStore provides a ranking of leaderboard identities based on a score.",frontMatter:{}},s=[{value:"DataStore Limits",id:"datastore-limits",level:2},{value:"Data Limits",id:"data-limits",level:3},{value:"Request and Throughput Limits",id:"request-and-throughput-limits",level:3},{value:"How do I run the unit tests?",id:"how-do-i-run-the-unit-tests",level:2}],p={toc:s},u="wrapper";function c(e){let{components:t,...r}=e;return(0,n.kt)(u,(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"rank-store"},"Rank Store"),(0,n.kt)("p",null,"RankStore is a reliable and scalable system for managing persistent leaderboards using ROBLOX DataStores. RankStore provides a ranking of leaderboard identities based on a score. "),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\ud83d\udd0d Employs Binary Search or Binary Trees for optimal insertion and retrieval of entries"),(0,n.kt)("li",{parentName:"ul"},"\ud83e\udda5 Lazy saving of leaderboard data to mitigate DataStore limits"),(0,n.kt)("li",{parentName:"ul"},"\ud83d\ude80 Compresses data to a higher base to minimise storage size"),(0,n.kt)("li",{parentName:"ul"},"\ud83d\udee1\ufe0f Ensures high data integrity through atomic updates or calling recovery methods in the event of consistency errors"),(0,n.kt)("li",{parentName:"ul"},"\u2b50 Stores data across multiple keys to be scalable to thousands of identities")),(0,n.kt)("p",null,"This module aims to overcome the current limitation of ROBLOX's Ordered Datastore which does not allow retrieval of specific ranks. At present, Ordered Datastores can only read 100 records per page and the entries must be read in sequence, which is impractical for large leaderboards with many thousands of entries."),(0,n.kt)("h1",{id:"limitations"},"Limitations"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Some use cases will not be suitable for this module. While RankStore has been designed with efficiency in mind, it has to operate within the ",(0,n.kt)("a",{parentName:"li",href:"https://create.roblox.com/docs/cloud-services/data-stores#server-limits"},"limits of ROBLOX Datastores"),", which cannot be changed. The general approach of RankStore is to trade-off real-time leaderboard accuracy for performance by periodically saving changes to the persistent DataStore. See the ",(0,n.kt)("a",{parentName:"li",href:"#performance"},"Performance Section")," to gauge whether RankStore is suitable for your use case."),(0,n.kt)("li",{parentName:"ul"},"The entry ID and score must be 5 byte and 4 byte ",(0,n.kt)("strong",{parentName:"li"},"integers")," respectively. These strict integer sizes allow the leaderboard to be compressed to a higher base.")),(0,n.kt)("h1",{id:"usage"},"Usage"),(0,n.kt)("p",null,"Add ",(0,n.kt)("inlineCode",{parentName:"p"},'rankstore = "123marble-rbx/rankstore@1.0.0"')," to your wally.toml."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-lua"},'local RankStore = require(game.ServerScriptService.RankStore)\nlocal rankStore = RankStore.GetRankStore("MyRankStore")\n\nrankStore:SetScoreAsync(1, 25) -- pass in user id, score\nrankStore:SetScoreAsync(2, 50)\nrankStore:SetScoreAsync(3, 20)\nrankStore:SetScoreAsync(4, 75)\n\nprint(rankStore:GetTopScoresAsync(10))\n\nprint(rankStore:GetEntryAsync(3))\n-- {\n--     ["id"] = 3,\n--     ["rank"] = 4,\n--     ["score"] = 20\n-- }  \n')),(0,n.kt)("p",null,"Full API is available on ",(0,n.kt)("a",{parentName:"p",href:"https://123marble.github.io/RankStore/api/RankStore"},"123marble.github.io/RankStore/api/RankStore"),"."),(0,n.kt)("h1",{id:"performance"},"Performance"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Method"),(0,n.kt)("th",{parentName:"tr",align:null},"Algorithm Time Complexity"),(0,n.kt)("th",{parentName:"tr",align:null},"Network Time Complexity"),(0,n.kt)("th",{parentName:"tr",align:null},"Datastore Requests"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"GetRankStore"),(0,n.kt)("td",{parentName:"tr",align:null},"O(1)"),(0,n.kt)("td",{parentName:"tr",align:null},"O(1)"),(0,n.kt)("td",{parentName:"tr",align:null},"1 GetAsync")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"SetScoreAsync"),(0,n.kt)("td",{parentName:"tr",align:null},"O(log n)"),(0,n.kt)("td",{parentName:"tr",align:null},"O(n)"),(0,n.kt)("td",{parentName:"tr",align:null},"2 UpdateAsync",(0,n.kt)("br",null)," N-1 GetAsync")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"GetEntryAsync"),(0,n.kt)("td",{parentName:"tr",align:null},"O(log n)"),(0,n.kt)("td",{parentName:"tr",align:null},"O(n)"),(0,n.kt)("td",{parentName:"tr",align:null},"N GetAsync")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"GetTopScoresAsync (k)"),(0,n.kt)("td",{parentName:"tr",align:null},"O(k)"),(0,n.kt)("td",{parentName:"tr",align:null},"O(n)"),(0,n.kt)("td",{parentName:"tr",align:null},"N GetAsync")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"ClearAsync"),(0,n.kt)("td",{parentName:"tr",align:null},"O(1)"),(0,n.kt)("td",{parentName:"tr",align:null},"O(1)"),(0,n.kt)("td",{parentName:"tr",align:null},"1 SetAsync")))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"N=num buckets, n=total entries")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"NB: This table applies to only the optimal 'avl' tree ",(0,n.kt)("inlineCode",{parentName:"strong"},"dataStructure"),".")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"NB: A DataStore GetAsync or UpdateAsync request retrieves the entire leaderboard data over the network. It is therefore crucial to performance to set the ",(0,n.kt)("inlineCode",{parentName:"strong"},"lazySaveTime")," parameter appropriately to periodically save changes to the DataStore. Lazy Saving will cause a server to  be out of sync with the true leaderboard stored in DataStore temporarily, but will at least be correct for any changes made within the server.")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"NB: The N GetAsync requests are made in parallel if the ",(0,n.kt)("inlineCode",{parentName:"strong"},"parallel")," parameter is set to true.")),(0,n.kt)("h2",{id:"datastore-limits"},"DataStore Limits"),(0,n.kt)("h3",{id:"data-limits"},"Data Limits"),(0,n.kt)("p",null,"Each entry requires only 9 characters for storage. The current storage limit for DataStore is 4,194,304 characters per key which equates to approximately a maximum 450k entries that are storable in 1 key. The ",(0,n.kt)("inlineCode",{parentName:"p"},"maxBucketsSize")," parameter will set the maximum number of characters per key."),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"numBuckets")," parameter allows you to set the number of keys that the leaderboard is shared over. Therefore, the maximum number of entries storable in your RankStore is ",(0,n.kt)("inlineCode",{parentName:"p"},"(numBuckets*maxBucketsSize) / 9"),"."),(0,n.kt)("h3",{id:"request-and-throughput-limits"},"Request and Throughput Limits"),(0,n.kt)("p",null,"Setting the ",(0,n.kt)("inlineCode",{parentName:"p"},"lazySaveTime")," parameter appropriately is crucuial for avoiding the request and throughput limits of DataStores."),(0,n.kt)("h1",{id:"contribute"},"Contribute"),(0,n.kt)("h2",{id:"how-do-i-run-the-unit-tests"},"How do I run the unit tests?"),(0,n.kt)("p",null,"Testing requires Wally, Rojo, and Roblox Studio."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Install packages with ",(0,n.kt)("inlineCode",{parentName:"li"},"wally install")),(0,n.kt)("li",{parentName:"ol"},"Sync ",(0,n.kt)("inlineCode",{parentName:"li"},"rojo")," with ",(0,n.kt)("inlineCode",{parentName:"li"},"default.project.json")),(0,n.kt)("li",{parentName:"ol"},"Run the Roblox Studio place"),(0,n.kt)("li",{parentName:"ol"},"Check output window for test status")))}c.isMDXComponent=!0}}]);